<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>JavaScript and HTML5</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="JavaScript and HTML5">
<meta property="og:url" content="http://imaffett.github.io/index.html">
<meta property="og:site_name" content="JavaScript and HTML5">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript and HTML5">
<meta name="twitter:description">
  
  
    <link rel="icon" href="favicon.png">
  
  
 <link href='//fonts.useso.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
 <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">


  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  

  

  
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo" style="background-image: url(/css/images/logo.png)"></i><span class="site-title">JavaScript and HTML5</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/.">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/css/images/avatar.png"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
      
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://imaffett.github.io"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
        
          <td><a class="main-nav-link" href="/.">Home</a></td>
        
          <td><a class="main-nav-link" href="/archives">Archives</a></td>
        
          <td><a class="main-nav-link" href="/categories">Categories</a></td>
        
          <td><a class="main-nav-link" href="/tags">Tags</a></td>
        
          <td><a class="main-nav-link" href="/about">About</a></td>
        
        <td>
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://imaffett.github.io"></form>
        </td>
      </tr>
    </table>
  </div>
</header>

    <div class="outer">
      
        <aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      <img id="avatar" src="/css/images/avatar.png">
      <h2 id="name">Ian Maffett</h2>
      <h3 id="title">undefined</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Lancaster, PA</span>
      <a id="follow" href="https://github.com/imaffett/">FOLLOW</a>
    </div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        1
        <span>post</span>
      </div>
      <div class="article-info-block">
        0
        <span>tag</span>
      </div>
    </div>
    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
          
          <td><a href="http://github.com/imaffett" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
          
          <td><a href="http://www.twitter.com/@imaffett" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
          
        </tr>
      </table>
    </div>
    
    
  </div>
</aside>

      
      <section id="main">
      <article id="post-Welcome" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/28/Welcome/">Welcome</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/09/28/Welcome/">
      <time datetime="2015-09-28T21:06:50.000Z" itemprop="datePublished">2015-09-28</time>
    </a>
  </div>


          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <h1 id="Another_way_to_test_Node-js_CLI_tools">Another way to test Node.js CLI tools</h1><p>I’ve been writing a few CLI tools using Node.js lately.  All of them require asynchronous code at some point in their calls; but some have multiple.  Ideally, I’d expose each function in a module properly and test them, but I wanted to be able to test the end users experience also, where they call the CLI tool and get different results back.  I could mock the HTTP requests, but I need the actual calls to execute.</p>
<h2 id="Let’s_test_this">Let’s test this</h2><p>While chatting to a few friends, I thought why not just spawn off the call and evaluate the response.  The particular tool that I was writing had multiple functions you could execute and calling each one allowed me to test the majority of my code.  I chose to use Chai/Assert for my tests.  Chai allows you to run asynchronous tests by passing in a “done” object into your test.  When you execute that object, it will complete the test for you.  Synchronous calls are tested normally as shown below.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cli = <span class="built_in">require</span>(<span class="string">'../src/index'</span>)</span><br><span class="line"></span><br><span class="line">describe(<span class="string">"Object functions"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    it(<span class="string">"should have a run function"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      cli.should.have.property(<span class="string">"run"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    it(<span class="string">"should have a help function"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      cli.should.have.property(<span class="string">"help"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Spawn_to_the_rescue">Spawn to the rescue</h2><p>Spawn allows us to execute the CLI code, with parameters, and capture the output to evaluate.  This allowed me to closely replicate an end users experience using the CLI tool.  I decided to create a known passing and failing test for each asynchronous operation.  spawn allows us to capture the standard output and standard error from the CLI call.  If there are any errors, we can check to see if the test should pass or fail.</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">it<span class="list">(<span class="string">"Should return the banner and commands"</span>,function<span class="list">(<span class="keyword">done</span>)</span>&#123;</span><br><span class="line">      var banner=spawn<span class="list">(<span class="string">"../bin/tool"</span>,[<span class="string">""</span>],&#123;&#125;)</span><span class="comment">;</span></span><br><span class="line">      var buffer=null<span class="comment">;</span></span><br><span class="line">      banner.stdout.on<span class="list">(<span class="string">"data"</span>,function<span class="list">(<span class="keyword">data</span>)</span>&#123;</span><br><span class="line">        buffer+=data<span class="comment">;</span></span><br><span class="line">      &#125;)</span><span class="comment">;</span></span><br><span class="line">      banner.stderr.on<span class="list">(<span class="string">"data"</span>,function<span class="list">(<span class="keyword">err</span>)</span>&#123;</span><br><span class="line">        assert.ok<span class="list">(<span class="keyword">false</span>,<span class="string">"Error "</span>+err)</span><span class="comment">;</span></span><br><span class="line">        done<span class="list">()</span><span class="comment">;</span></span><br><span class="line">      &#125;)</span><span class="comment">;</span></span><br><span class="line">      banner.on<span class="list">(<span class="string">"close"</span>,function<span class="list">()</span>&#123;</span><br><span class="line">        buffer.indexOf<span class="list">(<span class="string">"Tool Title"</span>)</span>.should.not.equal<span class="list">(<span class="keyword">-1</span>)</span><span class="comment">;</span></span><br><span class="line">        done<span class="list">()</span><span class="comment">;</span></span><br><span class="line">      &#125;)</span><span class="comment">;</span></span><br><span class="line">&#125;)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>The second parameter of spawn is an array of arguments to pass, allowing me to test each of the calls available.  We buffer the standard output to compare against in the close event.  In our case below, we are only looking for the string “Project Created” to let us know a new project was created.</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">"Should return the banner and commands with invalid arguments"</span>,<span class="function"><span class="keyword">function</span><span class="params">(done)</span></span>&#123;</span><br><span class="line">      <span class="keyword">var</span> banner=spawn(<span class="string">"../bin/tool"</span>,[<span class="string">"create"</span>,<span class="string">"foobar"</span>],&#123;&#125;);</span><br><span class="line">      <span class="keyword">var</span> buffer=<span class="literal">null</span>;</span><br><span class="line">      banner.stdout.on(<span class="string">"data"</span>,<span class="function"><span class="keyword">function</span><span class="params">(data)</span></span>&#123;</span><br><span class="line">        buffer+=data;</span><br><span class="line">      &#125;);</span><br><span class="line">      banner.stderr.on(<span class="string">"data"</span>,<span class="function"><span class="keyword">function</span><span class="params">(err)</span></span>&#123;</span><br><span class="line">        assert.ok(<span class="literal">false</span>,<span class="string">"Error "</span>+err);</span><br><span class="line">        done();</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">//On the close event, we look at the buffer</span></span><br><span class="line">      banner.on(<span class="string">"close"</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">        buffer.indexOf(<span class="string">"Project Created"</span>).should.not.equal(-<span class="number">1</span>);</span><br><span class="line">        done();</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Not_the_end_all">Not the end all</h2><p>This is not an end all solution for testing your Node.js code.  This can just be in addition to however your current testing environment is.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://imaffett.github.io/2015/09/28/Welcome/" data-id="cif5aawqz0000lih1tgy1w7g4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>



    </section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">recents</h3>
    <div class="widget">
      <ul id="recent-post" class="">
        
          <li>
            
            <div class="item-thumbnail">
              <a href="/2015/09/28/Welcome/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>
            </div>
            
            <div class="item-inner">
              <p class="item-category"></p>
              <p class="item-title"><a href="/2015/09/28/Welcome/" class="title">Welcome</a></p>
              <p class="item-date"><time datetime="2015-09-28T21:06:50.000Z" itemprop="datePublished">2015-09-28</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Ian Maffett<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    



 <script src="//ajax.useso.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68219669-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>